{
    "image": "debian:bookworm-slim",
    "features": {
        "ghcr.io/devcontainers/features/nix:1": {
            "packages": []  // home-manager handles packages
        }
    },
    "customizations": {
        "vscode": {
            "extensions": [
                "anthropic.claude-code",
                "jnoortheen.nix-ide",
                "skellock.just",
                "visualjj.visualjj"
            ],
            "settings": {
                "chat.agent.enabled": false,
                "editor.wordWrap": "on",
                "git.autofetch": true,
                "git.confirmSync": false,
                // "nix.enableLanguageServer": true, Command nil not found in $PATH (because it's installed later by direnv)
                // "nix.serverPath": "rnix-lsp",
                "workbench.secondarySideBar.defaultVisibility": "hidden"
            }
        }
    },
    "postCreateCommand": "bash ${containerWorkspaceFolder}/.devcontainer/setup.sh",
    // see: https://code.visualstudio.com/docs/sourcecontrol/faq#_why-is-vs-code-warning-me-that-the-git-repository-is-potentially-unsafe (because of nix)
    "postStartCommand": "git config --global --add safe.directory ${containerWorkspaceFolder} && jj config set --user user.name \"$(git config --get user.name)\" && jj config set --user user.email \"$(git config --get user.email)\" "
}